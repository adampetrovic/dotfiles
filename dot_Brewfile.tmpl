{{- if (eq .chezmoi.os "darwin") -}}
{{/* base level packages for all environments */}}
{{- $taps := list
    "homebrew/cask"
    "homebrew/cask-fonts"
    "homebrew/cask-versions"
    "homebrew/core"
    "homebrew/bundle"
    "buo/cask-upgrade"
    "hpedrorodrigues/tools" -}}

{{- $customTaps := dict -}}

{{- $brews := list
    "chezmoi"
    "coreutils"
    "git"
    "git-delta"
    "gnu-sed"
    "grep"
    "httpstat"
    "httpie"
    "mas"
    "ripgrep"
    "rsync"
    "vim"
    "watch"
    "wget"
    "zsh" -}}

{{- $casks := list
    "1password"
    "1password-cli"
    "alfred"
    "bartender"
    "cleanshot"
    "hpedrorodrigues/tools/dockutil"
    "fantastical"
    "font-fira-code"
    "google-chrome"
    "istat-menus"
    "iterm2"
    "obsidian"
    "rectangle"
    "spotify"
    "tomatobar"
    "telegram" -}}

{{- $mas := dict
    "Amphetamine" "937984704"
    "Instapaper" "288545208"
    "Reeder" "1529448980"
    "Things3" "904280696" -}}

{{/* personal-specific packages */}}
{{- if .personal -}}
{{-  $brews = concat $brews (list) -}}

{{-  $casks = concat $casks (list
        "calibre"
        "kindle-previewer"
        "handbrake") -}}

{{-  $mas = merge $mas (dict
        "Wireguard" "1451685025"
        "Parcel" "639968404") -}}
{{- end -}}


{{/* work-specific packages */}}
{{- if .work -}}
{{  $customTaps = merge $customTaps (dict
    "atlassian/micros" "ssh://git@stash.atlassian.com:7997/micros/homebrew-tap.git"
    "atlassian/cloudtoken" "ssh://git@bitbucket.org/atlassian/cloudtoken-homebrew-tap.git"
    "atlassian/kubetoken" "ssh://git@stash.atlassian.com:7997/kube/homebrew-kubetoken.git") -}}

{{  $brews = concat $brews (list
        "asdf"
        "atlas-cli"
        "kubectl"
        "kubectx"
        "kubetoken"
        "minikube") -}}

{{  $casks = concat $casks (list
        "cloudtoken"
        "goland"
        "intellij-idea"
        "pycharm"
        "slack"
        "zoom") -}}

{{  $mas = merge $mas (dict
        "Wireguard" "1451685025"
        "Parcel" "639968404") -}}
{{- end -}}

{{ range ($taps | sortAlpha | uniq) -}}
tap "{{ . }}"
{{ end }}
{{ range $name, $url := $customTaps -}}
tap "{{ $name }}", "{{ $url }}"
{{ end -}}
{{ range ($brews | sortAlpha | uniq) -}}
brew "{{ . }}"
{{ end }}
{{ range ($casks | sortAlpha | uniq) -}}
cask "{{ . }}"
{{ end }}
{{ range $app, $id := $mas -}}
mas "{{ $app }}", id: {{ $id }}
{{ end }}
{{- end -}}
